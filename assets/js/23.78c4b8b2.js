(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{222:function(t,e,a){"use strict";a.r(e);var s=a(0),v=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"vue-小记"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-小记"}},[t._v("#")]),t._v(" vue 小记")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5e4d24cce51d4526f76eb2ba",target:"_blank",rel:"noopener noreferrer"}},[t._v("2020年大厂面试指南 - Vue篇"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5cab64ce5188251b19486041",target:"_blank",rel:"noopener noreferrer"}},[t._v("「Vue实践」武装你的前端项目"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5d59f2a451882549be53b170",target:"_blank",rel:"noopener noreferrer"}},[t._v("30 道 Vue 面试题，内含详细讲解（涵盖入门到精通，自测 Vue 掌握程度）"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"vue-双向绑定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-双向绑定"}},[t._v("#")]),t._v(" vue 双向绑定")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("vue 双向绑定 1")]),t._v(" "),a("p",[t._v(":::cd")]),t._v(" "),a("p",[t._v("双向绑定是通过"),a("strong",[t._v("数据劫持")]),a("code",[t._v("Object.defineproperty()")]),t._v("结合"),a("strong",[t._v("发布者-订阅者模式")]),t._v("的方式来实现的。")]),t._v(" "),a("p",[t._v("注：此处讨论的是 "),a("code",[t._v("vue2.x")]),t._v(" 版本，"),a("code",[t._v("vue3.x")]),t._v(" 版本以从 "),a("code",[t._v("Object.defineproperty()")]),t._v("升级为 "),a("code",[t._v("Proxy()")])]),t._v(" "),a("p",[t._v("我们先看一段伪代码")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      people"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ziwen"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("created")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("people"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("我们可以看一下通过控制台输出一个定义在 vue 初始化数据上的对象长啥样。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/question/vue/qv1.png",alt:"图片"}}),t._v("\n属性 "),a("code",[t._v("name")]),t._v(" 对应着 "),a("code",[t._v("get")]),t._v(" 和 "),a("code",[t._v("set")]),t._v(" 方法，哪来的呢？"),a("code",[t._v("Object.defineproperty()")]),t._v("赋予的。")]),t._v(" "),a("p",[a("code",[t._v("Object.defineproperty()")]),t._v("到底是何方神圣？详细用法请看"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("这里")]),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"思路分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思路分析"}},[t._v("#")]),t._v(" 思路分析")]),t._v(" "),a("p",[t._v("其实就是数据劫持。接下来我们通过其原理实现一个简易版的 "),a("code",[t._v("mvvm")]),t._v(" 双向绑定代码。\n主要包含两大重点："),a("strong",[t._v("数据("),a("code",[t._v("data")]),t._v(")驱动视图("),a("code",[t._v("view")]),t._v(")")]),t._v("，"),a("strong",[t._v("视图("),a("code",[t._v("view")]),t._v(")更新数据("),a("code",[t._v("data")]),t._v(")")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/question/vue/sxbdyl.jpg",alt:"双向绑定原理"}})]),t._v(" "),a("p",[a("code",[t._v("view")]),t._v(" 更新 "),a("code",[t._v("data")]),t._v(" 可以通过事件监听（比如监听 "),a("code",[t._v("input")]),t._v(" 事件）\n"),a("code",[t._v("data")]),t._v(" 更新 "),a("code",[t._v("view")]),t._v(" 呢？重点是如何知道数据变了。其实不难发现上边的例子中可以看到 "),a("code",[t._v("Object.defineProperty()")]),a("strong",[t._v("给属性设置一个 "),a("code",[t._v("set")]),t._v(" 函数")]),t._v("，当数据改变了就会触发这个函数，所以我们只要将一些更新 "),a("code",[t._v("view")]),t._v(" 的方法添加到 "),a("code",[t._v("set")]),t._v(" 函数里就可以更新 "),a("code",[t._v("view")]),t._v(" 了。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/question/vue/qv2.jpg",alt:"图片"}})]),t._v(" "),a("h4",{attrs:{id:"实现双向绑定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现双向绑定"}},[t._v("#")]),t._v(" 实现双向绑定")]),t._v(" "),a("ul",[a("li",[t._v("设置一个 "),a("code",[t._v("Observer")]),t._v("，用来劫持并监听所有 "),a("code",[t._v("data")]),t._v(" 对象属性，如果有变化就通知订阅者。")]),t._v(" "),a("li",[t._v("设置一个 "),a("code",[t._v("Warcher")]),t._v("，可以收到属性的变化通知并执行响应的函数，来更新视图。")]),t._v(" "),a("li",[t._v("设置一个 "),a("code",[t._v("Dep")]),t._v("，用来收集订阅者，然后在 "),a("code",[t._v("Observer")]),t._v(" 和 "),a("code",[t._v("Watcher")]),t._v(" 之间进行统一管理。")]),t._v(" "),a("li",[t._v("设置一个 "),a("code",[t._v("Compile")]),t._v("，用来扫描和解析每个节点的相关指令，并根据初始化模板数据以及初始化相应的订阅器。")])]),t._v(" "),a("h4",{attrs:{id:"_1-设置一个-observer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置一个-observer"}},[t._v("#")]),t._v(" 1. 设置一个 Observer")]),t._v(" "),a("p",[t._v("用来劫持并监听所有 "),a("code",[t._v("data")]),t._v(" 对象属性。可以通过递归方法遍历所有属性，并用 "),a("code",[t._v("Object.defineProperty()")]),t._v("处理。\n另外需要一个 "),a("code",[t._v("Dep")]),t._v(" 订阅器负责收集订阅者，然后在属性变化时执行对应订阅者的更新函数。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code")])])])])}),[],!1,null,null,null);e.default=v.exports}}]);